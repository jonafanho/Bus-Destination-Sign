<app-dialog *transloco="let t" [title]="t('title.download-images-from-stop-reporter')" [(visible)]="visible">
	<div header class="row gap center">
		@if (getStopReporterLoading()) {
			<p-progressSpinner [style]="{width: '2rem', height: '2rem'}"/>
		}
		<p-button icon="pi pi-refresh" [rounded]="true" [text]="true" [pTooltip]="t('refresh-images')" tooltipPosition="bottom" (onClick)="fetchStopReporterDisplays()" [disabled]="getStopReporterLoading()"/>
	</div>

	<div content class="row gap wrapper">
		<div class="column">
			<div class="column gap" [formGroup]="searchFormGroup">
				<p-floatlabel variant="in">
					<p-auto-complete inputId="search" formControlName="searches" multiple [typeahead]="false" [addOnBlur]="true" [addOnTab]="true" separator="," [fluid]="true"/>
					<label for="search">{{ t('search') }}</label>
				</p-floatlabel>
				<div class="row gap-small center">
					<p-check-box inputId="exactMatch" formControlName="exactMatch" [binary]="true"/>
					<label for="exactMatch">{{ t('exact-match') }}</label>
				</div>
			</div>
			<p-divider/>
			<div class="column gap-small content" [formGroup]="categoryFiltersFormGroup">
				@for (category of categories; track $index) {
					@if (category[1]) {
						<div class="row gap-small center">
							<p-check-box [inputId]="'filter' + $index" [binary]="true" [formControlName]="'categoryFilter' + $index"/>
							<label [for]="'filter' + $index">{{ category[0] }}</label>
						</div>
					}
				}
			</div>
		</div>

		<p-table class="spacing content" [value]="getStopReporterList()" [paginator]="true" [rows]="20">
			<ng-template #body let-stopReporter>
				<tr>
					<td>{{ stopReporter.category }}</td>
					<td>{{ stopReporter.groups.join(', ') }}</td>
					<td class="table-image">
						<img [src]="getGoogleDriveImage(stopReporter.sources[0])" height="48" [alt]="stopReporter.category"/>
					</td>
					<td>
						@if (downloadStatus[stopReporter.sources[0]] === 'loading') {
							<p-button icon="pi pi-spinner" [rounded]="true" [text]="true" [disabled]="true"/>
						} @else if (downloadStatus[stopReporter.sources[0]] === 'success') {
							<p-button icon="pi pi-check" [rounded]="true" [text]="true" [disabled]="true"/>
						} @else {
							<p-button icon="pi pi-download" [rounded]="true" [text]="true" [pTooltip]="t('download-image')" tooltipPosition="bottom" (onClick)="downloadStopReporter(stopReporter.sources[0])"/>
						}
					</td>
				</tr>
			</ng-template>
		</p-table>
	</div>
</app-dialog>
