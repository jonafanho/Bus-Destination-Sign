<p-card *transloco="let t" [style]="{height: '100%', overflow: 'hidden'}">
	<ng-template #title>
		<div class="row gap center">
			<div class="column spacing">
				<h3>{{ t('title.display') }} {{ displayIndex + 1 }}</h3>
				<div class="subtitle">{{ getDisplayTypeName(getDisplay().displayType) }}</div>
			</div>
			@if (getDisplay().displayType === 'NONE') {
				<p-message icon="pi pi-info-circle">{{ t('message.no-display-type-selected') }}</p-message>
			}
			<div class="row">
				@if (getDisplay().displayType !== 'NONE') {
					<p-button icon="pi pi-plus" [rounded]="true" [text]="true" [pTooltip]="t('title.add-image')" tooltipPosition="bottom" (onClick)="addImageDialogVisible = true"/>
					<p-button icon="pi pi-folder-plus" [rounded]="true" [text]="true" [pTooltip]="t('tooltip.add-group-divider')" tooltipPosition="bottom" [disabled]="getDisplay().displayImages.length <= 1" (onClick)="editGroup(getDisplay().displayImages.length - 1, true)"/>
				}
				<p-button icon="pi pi-cog" [rounded]="true" [text]="true" [pTooltip]="t('title.display-settings')" tooltipPosition="bottom" (onClick)="settingsDialogVisible = true; displaySettingsComponent.updateForm()"/>
			</div>
		</div>
	</ng-template>

	@if (getDisplay().displayType !== 'NONE') {
		<br/>
		<div class="column gap-small content">
			@for (displayImage of getDisplay().displayImages; track $index) {
				@if (displayImage.startOfNewGroup || $index === 0) {
					<div class="row center">
						<p-divider/>
						<p-button icon="pi pi-angle-up" [rounded]="true" [text]="true" [pTooltip]="t('tooltip.move-group-divider-up')" tooltipPosition="bottom" [disabled]="$index === 0" (onClick)="moveGroup($index, -1)"/>
						<p-button icon="pi pi-angle-down" [rounded]="true" [text]="true" [pTooltip]="t('tooltip.move-group-divider-down')" tooltipPosition="bottom" (onClick)="moveGroup($index, 1)"/>
						<p-button icon="pi pi-trash" [rounded]="true" [text]="true" [pTooltip]="t('tooltip.delete-group-divider')" tooltipPosition="bottom" [disabled]="$index === 0" (onClick)="editGroup($index,false)"/>
					</div>
				}

				<p-panel>
					<ng-template #header>
						<div class="row gap center panel-header">
							<h4 class="spacing">{{ t('title.image') }} {{ $index + 1 }}</h4>
							<div class="row">
								<p-button icon="pi pi-pencil" [rounded]="true" [text]="true" [pTooltip]="t('tooltip.edit')" tooltipPosition="bottom" (onClick)="editImage($index, editImageComponent)"/>
								<p-button icon="pi pi-trash" [rounded]="true" [text]="true" [pTooltip]="t('tooltip.delete-image')" tooltipPosition="bottom" (onClick)="deleteImage($index)"/>
							</div>
						</div>
					</ng-template>
					<ng-template #content>
						<div class="row gap center">
							<div class="spacing">
								<img [src]="getUrlFromRawImageId(displayImage.rawImageId)" [alt]="displayImage.rawImageId" height="80"/>
							</div>
							@if ($count > 1) {
								<div class="column">
									<p-button icon="pi pi-angle-up" [rounded]="true" [text]="true" [pTooltip]="t('tooltip.move-image-up')" tooltipPosition="bottom" [disabled]="$index === 0" (onClick)="moveImage($index, -1)"/>
									<p-button icon="pi pi-angle-down" [rounded]="true" [text]="true" [pTooltip]="t('tooltip.move-image-down')" tooltipPosition="bottom" [disabled]="$index === $count - 1" (onClick)="moveImage($index, 1)"/>
								</div>
							}
						</div>
					</ng-template>
				</p-panel>
			}
		</div>
	}

	<app-dialog [title]="t('title.add-image')" [(visible)]="addImageDialogVisible">
		<div header class="row gap">
			<p-button icon="pi pi-images" [label]="t('title.raw-image-manager')" (onClick)="openRawImageManager()"/>
			<div></div>
		</div>
		<app-image-gallery content icon="pi pi-plus" (clickRawImage)="addImage($event, editImageComponent)"/>
	</app-dialog>

	<app-edit-image #editImageComponent [(visible)]="editImageDialogVisible" [displayIndex]="displayIndex"/>

	<app-dialog [title]="t('title.display-settings')" [(visible)]="settingsDialogVisible" maxWidth="24rem" maxHeight="24rem">
		<div content class="wrapper">
			<app-display-settings #displaySettingsComponent [displayIndex]="displayIndex"/>
		</div>
	</app-dialog>
</p-card>
